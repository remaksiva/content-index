<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Remaksiva: Find Your Clip</title>
    
    <link rel="icon" type="image/png" href="favicon.png"> 
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;800&display=swap" rel="stylesheet">
    
    <link href="https://cdn.jsdelivr.net/npm/bootswatch@5.3.3/dist/darkly/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLMD/CDyD1vJcK/kM5Q3gBfH7v9tV+C2mE6z6F3tC8JmS8F6B2vL2C1W/Q6H5zQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    
    <style>
        /* –ë–ê–ó–û–í–Ü –°–¢–ò–õ–Ü */
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #222; }
        .container { margin: 100px auto 20px auto; max-width: 90%; padding: 20px; border-radius: 8px; box-shadow: 0 0 20px rgba(204, 0, 105, 0.3); }
        h1 { font-family: 'Montserrat', sans-serif; font-weight: 800; font-size: 2.8em; color: #ffffff; margin-bottom: 20px; text-align: center; text-shadow: 2px 2px 6px rgba(204, 0, 105, 0.7); letter-spacing: 2px; padding-top: 10px; }
        #subheading-thanks, #subheading-value { font-family: 'Montserrat', sans-serif; font-size: 1.1em; font-weight: 600; color: #ccc; text-align: center; }
        #subheading-thanks { margin-top: -15px; margin-bottom: 5px; }
        #subheading-value { margin-bottom: 20px; padding-bottom: 5px; border-bottom: 1px solid rgba(204, 0, 105, 0.4); width: 80%; max-width: 800px; margin-left: auto; margin-right: auto; }
        #subheading-ua-thanks, #subheading-ua-value { font-family: 'Montserrat', sans-serif; font-size: 0.85em; font-style: italic; font-weight: 500; color: #999; text-align: center; line-height: 1.2; margin-top: 0px; margin-bottom: 3px; }
        #subheading-ua-value { margin-bottom: 30px; }
        #logo-image { display: block; margin: 0 auto 15px auto; max-width: 150px; height: auto; border-radius: 50%; border: 3px solid #375a7f; transition: opacity 0.2s; cursor: pointer; }
        #logo-image:hover { opacity: 0.8; }
        #channelButtonContainer { text-align: center; margin-bottom: 20px; }

        /* –°–¢–ò–õ–Ü –¢–ê–ë–õ–ò–¶–Ü */
        .styled-table {
            width: 100%;
            border-collapse: separate; 
            border-spacing: 0;
            margin-top: 20px;
            overflow: hidden; 
            border-radius: 8px; 
        }
        .styled-table thead th { 
            background-color: #33001a !important; 
            color: white; 
            text-align: center !important; 
            padding: 12px 10px;
            border: none;
            font-size: 1.0em;
        }
        .styled-table tbody td {
            border: 1px solid #333; 
            vertical-align: middle !important; 
            text-align: center !important; 
            padding: 10px;
            font-size: 0.95em;
        }
        .styled-table tbody tr {
            background-color: #2a2a2a; 
        }
        .styled-table tbody tr:nth-child(even) {
            background-color: #333; 
        }
        
        /* –ö–ù–û–ü–ö–ò –¢–ê –ü–û–°–ò–õ–ê–ù–ù–Ø */
        .styled-table tbody td a.btn-youtube {
            color: white !important;
            background-color: #cc0069 !important; 
            border-color: #cc0069 !important;
            padding: 5px 10px;
            display: inline-block;
            font-size: 0.9em;
        }
        .styled-table tbody td a.btn-youtube:hover {
            background-color: #cc0000 !important; 
            border-color: #cc0000 !important;
        }
        
        .styled-table tbody td a.btn-pexels {
            color: black !important;
            background-color: transparent !important; 
            border: 1px solid #08a080 !important;    
            border-radius: 10% !important;           
            padding: 2px; 
            margin: 2px;
            display: inline-flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 0.85em; 
            white-space: nowrap; 
            transition: filter 0.2s ease-in-out, background-color 0.2s ease-in-out; 
        }
        
        .styled-table tbody td a.btn-pexels:hover {
            background-color: rgba(8, 160, 128, 0.1) !important; 
            border-color: #08a080 !important; 
            filter: brightness(0.7); 
        }

        .pexels-icon {
            height: 2.4em; 
            width: auto;
            vertical-align: middle;
            border-radius: 10%; 
        }
        
        .pexels-links-container {
            max-width: 550px; 
            display: flex;
            flex-wrap: wrap; 
            justify-content: center; 
            margin: 0 auto;
        }

        /* –§–Ü–õ–¨–¢–† */
        #filterContainer { margin-bottom: 25px; display: flex; justify-content: center; align-items: center; text-align: center; }
        #filterContainer select {
            -webkit-appearance: none; -moz-appearance: none; appearance: none;
            background-image: none !important; padding-left: 15px !important;
            padding-right: 15px !important; text-align-last: center; text-align: center;
            font-size: 1.1em; padding-top: 8px; padding-bottom: 8px; border-radius: 6px;
            margin: 5px 0; width: 350px; max-width: 90%; height: auto; box-sizing: border-box;
        }
        
        .footer-thanks { margin-top: 40px; padding: 20px 0; color: #ccc; font-size: 0.9em; border-top: 1px solid #333; }
        
        /* –ê–î–ê–ü–¢–ò–í–ù–Ü–°–¢–¨ –î–õ–Ø –ú–û–ë–Ü–õ–¨–ù–û–á –í–ï–†–°–Ü–á */
        @media (max-width: 992px) {
            .container { max-width: 95%; padding: 10px; margin-top: 50px; }
            h1 { font-size: 2.0em; }
            #subheading-thanks, #subheading-value { font-size: 0.9em; }
            #subheading-ua-thanks, #subheading-ua-value { font-size: 0.75em; }

            /* –ó–±—ñ–ª—å—à—É—î–º–æ —Ñ—ñ–ª—å—Ç—Ä */
            #filterContainer select { 
                font-size: 1.3em !important; 
                padding: 10px 15px !important; 
                max-width: 95% !important; 
                width: 100% !important; 
            }

            /* –ó–±—ñ–ª—å—à—É—î–º–æ —Ç–µ–∫—Å—Ç —É —Ç–∞–±–ª–∏—Ü—ñ */
            .styled-table thead th { 
                font-size: 1.1em !important; 
                padding: 8px 5px; 
            }
            .styled-table tbody td { 
                font-size: 1.0em !important; 
                padding: 8px 5px;
            }

            /* –ó–±—ñ–ª—å—à—É—î–º–æ –∫–Ω–æ–ø–∫–∏ */
            .styled-table tbody td a.btn-youtube { 
                font-size: 1.0em !important; 
                padding: 0.4rem 0.8rem !important; 
                line-height: 1.2; 
            }
            .styled-table tbody td a.btn-pexels { 
                font-size: 1.0em !important; 
                padding: 4px; 
                margin: 3px;
            }
            .pexels-icon {
                height: 2.8em; 
            }
        }
    </style>
</head>
<body>
    <div class="container">
        
        <div id="channelButtonContainer">
             <a href="https://www.youtube.com/@remaksiva" target="_blank">
                <img id="logo-image" src="channels4_profile.jpg" alt="Channel Logo">
             </a>
        </div>
        
        <h1>Remaksiva: Find Your Clip</h1>
        
        <p id="subheading-thanks">
            With respect to the community, the REMAKSIVA project thanks the authors <br>
            for their video and photo materials.
        </p>

        <p id="subheading-value">
            Use this interactive index to check if Your works are featured here.
        </p>
        
        <p id="subheading-ua-thanks">
            –ó –ø–æ–≤–∞–≥–æ—é –¥–æ —Å–ø—ñ–ª—å–Ω–æ—Ç–∏, –ø—Ä–æ–µ–∫—Ç REMAKSIVA –¥—è–∫—É—î –∞–≤—Ç–æ—Ä–∞–º –∑–∞ —ó—Ö–Ω—ñ –≤—ñ–¥–µ–æ- —Ç–∞ —Ñ–æ—Ç–æ–º–∞—Ç–µ—Ä—ñ–∞–ª–∏.
        </p>

        <p id="subheading-ua-value">
            –°–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ—Å—è —Ü–∏–º —ñ–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∏–º —ñ–Ω–¥–µ–∫—Å–æ–º, —â–æ–± –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —á–∏ —î —Ç—É—Ç –í–∞—à—ñ —Ä–æ–±–æ—Ç–∏.
        </p>
        
        <div id="filterContainer"></div>

        <table id="acknowledgements-table" class="styled-table">
            <tbody>
                <tr>
                    <td colspan="4" style="text-align: center;">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö...</td>
                </tr>
            </tbody>
        </table>

    </div>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        const CSV_FILE_PATH = 'pexels_master_acknowledgements.csv'; 
        const TABLE_ID = 'acknowledgements-table';
        const FILTER_CONTAINER_ID = 'filterContainer';
        let fullValidData = []; 

        // ----------------------------------------------------
        // 1. –§–£–ù–ö–¶–Ü–Ø –ì–†–£–ü–£–í–ê–ù–ù–Ø –î–ê–ù–ò–• (–§—ñ–∫—Å–æ–≤–∞–Ω–µ –≥—Ä—É–ø—É–≤–∞–Ω–Ω—è –∑–∞ –ö–ª—ñ–ø–æ–º + –°–æ—Ä—Ç—É–≤–∞–Ω–Ω—è –∑–∞ –î–∞—Ç–æ—é)
        // ----------------------------------------------------
        function groupDataByClip(data, isFiltered = false) {
            const groupedByClip = {};
            
            data.forEach(row => {
                if (!row.Clip_Final_Name || !row.Pexels_Author) return; 

                const clipName = row.Clip_Final_Name;
                const author = row.Pexels_Author;

                if (!groupedByClip[clipName]) {
                    groupedByClip[clipName] = {
                        Name: clipName,
                        Date: row.Clip_Publication_Date,
                        ClipURL: row.Clip_Public_URL,
                        Authors: {} 
                    };
                }

                if (!groupedByClip[clipName].Authors[author]) {
                    groupedByClip[clipName].Authors[author] = {
                        PexelsAuthor: author,
                        MediaItems: []
                    };
                }
                
                groupedByClip[clipName].Authors[author].MediaItems.push({
                    PexelsURL: row.Pexels_URL,
                    PexelsID: row.Pexels_ID
                });
            });

            const result = Object.values(groupedByClip).map(clip => ({
                ...clip,
                Authors: Object.values(clip.Authors)
            }));

            // üí° 1. –°–û–†–¢–£–í–ê–ù–ù–Ø –ö–õ–Ü–ü–Ü–í –ó–ê –î–ê–¢–û–Æ (–í–Ü–î –ù–ê–ô–ù–û–í–Ü–®–û–ì–û –î–û –ù–ê–ô–°–¢–ê–†–Ü–®–û–ì–û)
            result.sort((a, b) => {
                // –ü—Ä–∏–ø—É—Å–∫–∞—î–º–æ —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç–∏ DD.MM.YYYY —ñ –ø–µ—Ä–µ—Ç–≤–æ—Ä—é—î–º–æ –π–æ–≥–æ –Ω–∞ YYYYMMDD –¥–ª—è –∫–æ—Ä–µ–∫—Ç–Ω–æ–≥–æ –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è
                const dateA = a.Date.split('.').reverse().join(''); 
                const dateB = b.Date.split('.').reverse().join(''); 
                
                // –°–æ—Ä—Ç—É–≤–∞–Ω–Ω—è –∑–∞ —Å–ø–∞–¥–∞–Ω–Ω—è–º
                if (dateA > dateB) return -1;  
                if (dateA < dateB) return 1;   
                return 0;
            });


            // üí° 2. –õ–û–ì–Ü–ö–ê –î–õ–Ø –†–ï–ñ–ò–ú–£ "–í–°–Ü –ê–í–¢–û–†–ò":
            if (!isFiltered) {
                return result.map(clip => {
                    const authorNames = clip.Authors.map(a => a.PexelsAuthor);
                    
                    // –°–û–†–¢–£–í–ê–ù–ù–Ø –ê–í–¢–û–†–Ü–í –ó–ê –ê–õ–§–ê–í–Ü–¢–û–ú (–Ü–≥–Ω–æ—Ä—É—î —Ä–µ–≥—ñ—Å—Ç—Ä)
                    authorNames.sort((a, b) => a.toLowerCase().localeCompare(b.toLowerCase(), 'uk', { sensitivity: 'base' })); 
                    
                    const allAuthorsList = authorNames.join('<br>');
                    
                    return {
                        ...clip,
                        Authors: [{ PexelsAuthor: allAuthorsList, MediaItems: [] }]
                    };
                });
            }

            return result;
        }

        // ----------------------------------------------------
        // 2. –§–£–ù–ö–¶–Ü–Ø –†–ï–ù–î–ï–†–ò–ù–ì–£ –¢–ê–ë–õ–ò–¶–Ü (–û–Ω–æ–≤–ª–µ–Ω—ñ –∑–∞–≥–æ–ª–æ–≤–∫–∏)
        // ----------------------------------------------------
        function renderTable(groupedData, isFiltered = false) {
            const table = document.getElementById(TABLE_ID);
            if (!table) return;

            // üí° –û–ù–û–í–õ–ï–ù–ù–Ø –ó–ê–ì–û–õ–û–í–ö–Ü–í –ù–ê –ê–ù–ì–õ–Ü–ô–°–¨–ö–£
            let lastHeader = isFiltered ? 'Source' : 'Authors'; // Source —É —Ä–µ–∂–∏–º—ñ —Ñ—ñ–ª—å—Ç—Ä–∞, Authors —É —Ä–µ–∂–∏–º—ñ "–í—Å—ñ"
            let thead = '<thead><tr>';
            // Clip Name | Date | YouTube | Authors/Source
            const headers = ['Clip Name', 'Date', 'YouTube', lastHeader]; 
            headers.forEach(h => {
                thead += `<th>${h}</th>`;
            });
            thead += '</tr></thead>';
            
            let tbody = '<tbody>';
            
            if (groupedData.length === 0) {
                 tbody += '<tr><td colspan="4">No records found.</td></tr>';
            } else {
                groupedData.forEach(clipGroup => {
                    if (clipGroup.Authors.length === 0) return; 

                    const totalRows = clipGroup.Authors.length; 
                    const clipLinkHTML = `<a href="${clipGroup.ClipURL}" target="_blank" class="btn btn-youtube btn-sm"><i class="fab fa-youtube"></i> YouTube</a>`;

                    clipGroup.Authors.forEach((authorData, index) => {
                        
                        let finalContent = '';
                        
                        if (isFiltered) {
                            let pexelsCellContent = '';
                            authorData.MediaItems.forEach(media => {
                                pexelsCellContent += `<a href="${media.PexelsURL}" target="_blank" class="btn btn-pexels btn-sm">
                                    <img src="pexels_icon.png" alt="Pexels" class="pexels-icon">
                                </a>`;
                            });
                            finalContent = `<div class="pexels-links-container">${pexelsCellContent}</div>`;
                        } else {
                            finalContent = `<div>${authorData.PexelsAuthor}</div>`;
                        }

                        tbody += `<tr class="clip-row">`;

                        if (index === 0) { 
                            tbody += `
                                <td rowspan="${totalRows}">${clipGroup.Name}</td>
                                <td rowspan="${totalRows}">${clipGroup.Date}</td>
                                <td rowspan="${totalRows}">${clipLinkHTML}</td>
                            `;
                        }

                        tbody += `
                            <td>${finalContent}</td>
                        </tr>`;
                    });
                });
            }
            
            tbody += '</tbody>';
            
            table.innerHTML = thead + tbody;
        }


        // ----------------------------------------------------
        // 3. –§–£–ù–ö–¶–Ü–Ø –§–Ü–õ–¨–¢–†–ê–¶–Ü–á 
        // ----------------------------------------------------
        function setupAuthorFilter(data) { 
            const container = $('#' + FILTER_CONTAINER_ID);
            
            const allAuthors = data.map(item => item.Pexels_Author);
            const uniqueAuthors = [...new Set(allAuthors)]
                .filter(a => a && a.toString().trim() !== '')
                .map(a => a.toString().trim())
                .sort((a, b) => a.toLowerCase().localeCompare(b.toLowerCase(), 'uk', { sensitivity: 'base' })); 

            // –¢–µ–∫—Å—Ç —Ñ—ñ–ª—å—Ç—Ä–∞: "push me"
            const select = $('<select id="authorFilterSelect" class="form-select"><option value="">\u25bc&nbsp;&nbsp;&nbsp;&nbsp;push me&nbsp;&nbsp;&nbsp;&nbsp;\u25b2</option></select>')
                .appendTo(container);
            
            uniqueAuthors.forEach(function(author) {
                const display = author.length > 50 ? author.substring(0, 50) + '...' : author;
                select.append('<option value="' + author + '">' + display + '</option>');
            });

            select.on('change', function() {
                const selectedAuthor = $(this).val();
                
                let filteredData = fullValidData;
                let isFiltered = false; 

                if (selectedAuthor) {
                    filteredData = fullValidData.filter(row => row.Pexels_Author === selectedAuthor);
                    isFiltered = true;
                }
                
                const grouped = groupDataByClip(filteredData, isFiltered); 
                renderTable(grouped, isFiltered); 
            });
        }


        // ----------------------------------------------------
        // 4. –û–°–ù–û–í–ù–ò–ô –ë–õ–û–ö –í–ò–ö–û–ù–ê–ù–ù–Ø 
        // ----------------------------------------------------
        $(document).ready(function() {
            Papa.parse(CSV_FILE_PATH, {
                download: true,
                header: true,
                skipEmptyLines: true,
                delimiter: ';', 
                complete: function(results) {
                    if (results.data.length === 0) {
                        $('#' + TABLE_ID).html('<tbody><tr><td colspan="4" class="alert alert-warning text-center mt-4">CSV file loaded, but contains no data.</td></tr></tbody>');
                        return;
                    }
                    
                    fullValidData = results.data.filter(row => row.Pexels_ID && row.Status === 'OK');
                    
                    if (fullValidData.length === 0) {
                        $('#' + TABLE_ID).html('<tbody><tr><td colspan="4">No confirmed media (Status=OK) found for display.</td></tr></tbody>');
                        return;
                    }
                    
                    const initialGrouped = groupDataByClip(fullValidData, false); 
                    renderTable(initialGrouped, false);
                    
                    setupAuthorFilter(fullValidData);
                },
                error: function(error) {
                    let errorMessage = "Critical error loading data or processing CSV. Check: 1) CSV file name. 2) Python server status. Details: " + error.message;
                    $('#' + TABLE_ID).html('<tbody><tr><td colspan="4" class="alert alert-danger text-center mt-4">' + errorMessage + '</td></tr></tbody>');
                    console.error("PapaParse Error:", error);
                }
            });
        });
    </script>
    
    <footer class="text-center footer-thanks">
        <p>
            The <a href="https://www.youtube.com/@remaksiva" target="_blank" class="text-info">Remaksiva</a> Project sincerely thanks:
            <br>
            The 
            <a href="https://www.pexels.com/" target="_blank" class="text-info">Pexels</a> 
            community and all authors for the provided photo and video materials. 
            <br>
            As well as the 
            <a href="https://www.youtube.com/" target="_blank" class="text-info">YouTube</a> 
            platform for the opportunity to share video content.
        </p>
    </footer>
</body>
</html>
